<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOEFL Writing Assistant - TGI Writing</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Alibaba+PuHuiTi+3.0:wght@400;500;600;700;800;900&family=Taviraj:wght@400;500;600;700&family=PingFang+SC:wght@400;500;600;700&display=swap');
        
        body { 
            font-family: 'PingFang SC', 'Alibaba PuHuiTi 3.0', sans-serif; 
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        .tab-button {
            transition: all 0.3s ease;
        }
        
        .tab-button:hover {
            background-color: #f8fafc;
        }
        
        .mode-content {
            transition: all 0.3s ease;
        }
        
        .feedback-tab {
            transition: all 0.3s ease;
        }
        
        .feedback-tab:hover {
            background-color: #f8fafc;
        }
        
        /* Writing overlay styles */
        #writing-display {
            font-size: 14px;
            overflow: hidden;
            pointer-events: none;
        }
        
        #user-essay:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        /* Enhanced highlight styles */
        .highlight-error {
            background-color: rgba(239, 68, 68, 0.2);
            border-bottom: 2px wavy #ef4444;
            padding: 1px 2px;
            border-radius: 2px;
            animation: fadeInHighlight 0.5s ease-in;
        }
        
        .highlight-grammar {
            background-color: rgba(239, 68, 68, 0.15);
            border-bottom: 2px dotted #ef4444;
            padding: 1px 2px;
            border-radius: 2px;
            animation: fadeInHighlight 0.5s ease-in;
        }
        
        .highlight-weakness {
            background-color: rgba(251, 191, 36, 0.2);
            border-bottom: 2px solid #f59e0b;
            padding: 1px 2px;
            border-radius: 2px;
            animation: fadeInHighlight 0.5s ease-in;
        }
        
        .highlight-vocab {
            background-color: rgba(59, 130, 246, 0.2);
            border-bottom: 2px solid #3b82f6;
            padding: 1px 2px;
            border-radius: 2px;
            animation: fadeInHighlight 0.5s ease-in;
        }
        
        .highlight-strength {
            background-color: rgba(34, 197, 94, 0.2);
            border-bottom: 2px solid #22c55e;
            padding: 1px 2px;
            border-radius: 2px;
            animation: fadeInHighlight 0.5s ease-in;
        }
        
        .highlight-default {
            background-color: rgba(156, 163, 175, 0.2);
            border-bottom: 1px solid #9ca3af;
            padding: 1px 2px;
            border-radius: 2px;
        }
        
        /* Highlight animations */
        @keyframes fadeInHighlight {
            0% { 
                background-color: transparent; 
                transform: scale(1);
            }
            50% {
                transform: scale(1.02);
            }
            100% { 
                background-color: inherit; 
                transform: scale(1);
            }
        }
        
        /* Analysis panel styles */
        #analysis-panel {
            backdrop-filter: blur(10px);
            background-color: rgba(255, 255, 255, 0.95);
        }
        
        /* Responsive design for smaller screens */
        @media (max-width: 1024px) {
            #analysis-panel {
                width: 100%;
                transform: translateY(100%);
            }
            
            #analysis-panel:not(.translate-x-full) {
                transform: translateY(0);
            }
            
            .translate-x-full {
                transform: translateY(100%) !important;
            }
        }
        
        /* Smooth transitions for panel */
        #analysis-panel {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Custom scrollbar for analysis panel */
        #feedback-content::-webkit-scrollbar {
            width: 6px;
        }
        
        #feedback-content::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        
        #feedback-content::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        
        #feedback-content::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Logo styles similar to easywriting.site */
        .logo-container {
            position: relative;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: opacity 0.3s ease;
            margin: 44px 0 42px 41px;
        }
        
        .logo-container:hover {
            opacity: 0.8;
        }
        
        .logo-badge {
            position: absolute;
            top: -3px;
            left: 0;
            width: 65px;
            height: 25px;
            background-color: #2563eb;
            border-radius: 6px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .logo-text {
            display: flex;
            align-items: end;
            margin-top: 8px;
            gap: 8px;
        }

        /* Enhanced task card styling */
        .TaskCard {
            background: white;
            border-radius: 20px;
            margin: 0 24px;
            margin-top: -12px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            border: 1px solid #2563eb;
        }


        /* Tab styling */
        .active-tab {
            background: #eff6ff;
            transform: scale(1.05);
            z-index: 10;
            margin-right: -8px;
            border: 1px solid #2563eb;
        }

        .inactive-tab {
            background: #e5e7eb;
            transform: scale(1);
            z-index: 0;
        }
    </style>
</head>

<body class="bg-neutral-50 text-gray-800">
    <!-- Header -->
    <header class="relative w-full h-24 bg-white shadow flex justify-between items-center fixed z-30">
        <!-- Logo -->
        <div class="logo-container">
            <div class="logo-badge">
                <div class="text-white text-lg font-black font-['Alibaba_PuHuiTi_3.0']">TOEFL</div>
            </div>
            <div class="logo-text">
                <div class="text-black text-3xl font-medium font-['Taviraj']">EasyWriting</div>
                <div class="text-4xl">ğŸ‡ºğŸ‡¸</div>
            </div>
        </div>
        
        <!-- Navigation -->
        <nav class="hidden md:flex space-x-10 absolute left-[430px]">
            <a href="/" class="text-[#333333] text-lg font-black font-['Alibaba PuHuiTi 3.0'] transition rounded cursor-pointer hover:bg-neutral-200 hover:scale-105 px-4 py-2">ä½œæ–‡æ‰¹æ”¹</a>
            <a href="#" class="text-[#7b7b7b] text-lg font-normal font-['Alibaba PuHuiTi 3.0'] transition rounded cursor-pointer hover:bg-neutral-200 hover:scale-105 px-4 py-2">Step-by-step</a>
            <a href="#" class="text-[#7b7b7b] text-lg font-normal font-['Alibaba PuHuiTi 3.0'] transition rounded cursor-pointer hover:bg-neutral-200 hover:scale-105 px-4 py-2">è¿‘æœŸè€ƒé¢˜</a>
            <a href="#" class="text-[#7b7b7b] text-lg font-normal font-['Alibaba PuHuiTi 3.0'] transition rounded cursor-pointer hover:bg-neutral-200 hover:scale-105 px-4 py-2">è¯é¢˜åˆ†ç±»</a>
            <a href="#" class="text-[#7b7b7b] text-lg font-normal font-['Alibaba PuHuiTi 3.0'] transition rounded cursor-pointer hover:bg-neutral-200 hover:scale-105 px-4 py-2">æˆä¸ºä¼šå‘˜</a>
        </nav>
        
        <!-- Auth Buttons -->
        <div class="flex items-center space-x-2 mr-8">
            <button class="w-28 h-12 px-5 py-1 rounded-full border border-[#e5e6ea] flex justify-center items-center hover:bg-neutral-200 hover:scale-105 transition-all">
                <div class="text-[#011400] text-lg font-normal font-['PingFang SC']">ç™»å½•</div>
            </button>
            <button class="w-28 h-12 px-5 py-1 bg-black rounded-full flex justify-center items-center hover:bg-slate-900 hover:scale-105 transition-all">
                <div class="text-white text-lg font-normal font-['PingFang SC']">æ³¨å†Œ</div>
            </button>
        </div>
    </header>

    <!-- Hero Section -->
    <div class="bg-neutral-50 pt-24">
        <div class="slideshow flex flex-col">
            <div class="mx-auto w-full px-20 flex items-center justify-center flex-col h-auto rounded-2xl pt-4">
                <div class="w-full max-w-2xl text-center text-[#011400] text-2xl font-normal font-['Taviraj'] mb-4">
                    <span>TOEFL Writing has never been so easy ï¼</span>
                </div>
                <div class="mt-4 w-full max-w-4xl">
                    <div class="h-8 w-full text-center text-[#666666] text-base font-normal font-['Taviraj'] overflow-hidden relative">
                        <div class="static-text">å‡†å¤‡TOEFLå†™ä½œè€ƒè¯•ï¼Ÿè·å¾—ä¸“ä¸šçš„AIåé¦ˆå’Œè¯„åˆ†ï¼Œ<strong>æ·»åŠ å¾®ä¿¡å·å®¢æœ: <span class="wechat-id">Jam2024JJ</span><button class="copy-btn ml-2" title="ç‚¹å‡»å¤åˆ¶å¾®ä¿¡å·"> ğŸ“‹ </button></strong> è·å¾—æ›´å¤šæ‰¹æ”¹æ¬¡æ•°! ğŸš€</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Section -->
        <div class="MainSection mx-auto flex justify-center pl-14 pb-5 pt-2 bg-neutral-50">
            <div class="grid grid-cols-3 gap-6">
                <div class="col-span-2 space-y-2 w-full max-w-4xl">
                    <!-- Tab Section -->
                    <div class="flex relative h-28 px-6 py-2">
                        <button id="tab-correction" class="active-tab p-4 rounded-2xl w-1/2 text-center h-20 transition-all duration-300 ease-in-out origin-left relative">
                            <div class="text-[#011400] text-2xl font-black font-['Alibaba PuHuiTi 3.0']">ä½œæ–‡æ‰¹æ”¹</div>
                        </button>
                        <button id="tab-stepbystep" class="inactive-tab p-4 rounded-2xl w-1/2 text-center h-20 transition-all duration-300 ease-in-out origin-right flex flex-row justify-center items-center relative">
                            <img class="w-16 h-16 pt-2" src="data:image/png;base64,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" alt="Step by Step">
                            <div class="text-[#010101] text-2xl font-semibold font-['Alibaba PuHuiTi 3.0']">Step-by-Step</div>
                        </button>
                    </div>

                    <!-- Task Input Card -->
                    <div class="TaskCard">
                        <div class="task-input-panel bg-white rounded-2xl w-full flex flex-col relative">
                            <!-- Prompt Selection -->
                            <div class="p-4">
                                <h3 class="text-lg font-semibold mb-2 font-['Alibaba PuHuiTi 3.0']">Select a TOEFL Writing Prompt</h3>
                                <select id="prompt" class="w-full p-3 border rounded-lg mb-4 focus:outline-none focus:border-blue-500">
                                    <option value="1">Do you agree or disagree with the following statement? People attend college or university for many different reasons (for example, new experiences, career preparation, increased knowledge). Why do you think people attend college or university?</option>
                                    <option value="2">Do you agree or disagree with the following statement? Parents are the best teachers. Use specific reasons and examples to support your answer.</option>
                                    <option value="3">Nowadays, food has become easier to prepare. Has this change improved the way people live? Use specific reasons and examples to support your answer.</option>
                                    <option value="4">It has been said, "Not everything that is learned is contained in books." Compare and contrast knowledge gained from experience with knowledge gained from books. In your opinion, which source is more important? Why?</option>
                                    <option value="5">A company has announced that it wishes to build a large factory near your community. Discuss the advantages and disadvantages of this new influence on your community. Do you support or oppose the factory?</option>
                                </select>
                                
                                <div class="button-group flex space-x-4 mb-5 h-9">
                                    <button class="random-question-button w-30 flex items-center bg-white border border-gray-300 px-3 py-2 rounded-full shadow hover:bg-gray-300 hover:scale-105">
                                        <img src="data:image/svg+xml,%3csvg%20width='20'%20height='20'%20viewBox='0%200%2020%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20id='Shuffle-one%20(%26%23230%3b%26%23180%3b%26%23151%3b%26%23231%3b%26%23137%3b%26%23140%3b)'%3e%3cpath%20id='Vector'%20d='M16.6667%2013.75L18.3334%2015.4167L16.6667%2017.0833'%20stroke='%23011400'%20stroke-width='1.66667'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20id='Vector_2'%20d='M16.6667%202.91675L18.3334%204.58341L16.6667%206.25008'%20stroke='%23011400'%20stroke-width='1.66667'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20id='Vector_3'%20d='M18.3333%204.58325H15.4167C12.4251%204.58325%2010%207.00838%2010%209.99992C10%2012.9915%2012.4251%2015.4166%2015.4167%2015.4166H18.3333'%20stroke='%23011400'%20stroke-width='1.66667'%20stroke-linecap='round'/%3e%3cpath%20id='Vector_4'%20d='M1.66669%2015.4166H4.58335C7.5749%2015.4166%2010%2012.9915%2010%209.99992C10%207.00838%207.5749%204.58325%204.58335%204.58325H1.66669'%20stroke='%23011400'%20stroke-width='1.66667'%20stroke-linecap='round'/%3e%3c/g%3e%3c/svg%3e" alt="éšæœºé¢˜ç›®" class="w-4 h-4 mr-2">
                                        <p class="text-sm font-normal font-['PingFang SC']">éšæœºé¢˜ç›®</p>
                                    </button>
                                    <button class="recent-exam-button flex items-center bg-white border border-gray-300 px-4 py-2 rounded-full shadow hover:bg-gray-300 hover:scale-105">
                                        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAQdSURBVHgBtVVLTFxVGP7OfffOM8PMQHnTdgKVNjRNJepCpVBMWk2MXeKyjQsfoYmxuiiERBaibozu6MKNMcZETUjUtIlECEVaSMVFTdq0UDDAwCAMDB3mde8993jupUxnoGMhtF9y5/znzPn/73/d/wIF0P39lXN4QqCPOvysbzAUnpro/fTy1VI8LRIT5G1uGC6ui3Y8DRLLe0/Qf9aSl2Jr57v7+gLYI7aROFV3p8PtrqIKw1oqVRKJ4QL2iDyS7sujRd5g4H3TMHBzeAAqYwgvRy9+3t/vxx6g5G4a1mcSqxX7YqZpBs+8ewHhlRWkDX3p4qlT9zfvZAarjigqeU2YqAchfgGxILiYUhXn76Rp+s5jSdra2filG3evSfF1ay/JUOR235WiEMMHag2Tf00IWiXBBoQAkQuhBNzUoA/V/KZQ+h45MTOVa3dbTVaXo3+m4wlbXo7HoSrsmhipPscFv6lponVy1kQhECJOy3v3+NXqzrzzTUEMhlwIAfNL+0f9xUXH+cw41jUZjc5ilX7YHdb7YwZ//AV8dJah8YiC/4Nu4hX3yfBgNl3ieijENX0UM8LT0et0MdWFdKIOibSClEYDv3ZNgFGBsb912dYmEil31pgV2aUfOFpeAN5oVrPnDka+lMuz2XSZ3PhQxlQu4/VRNaBSRwCLMSfW00zmmiCW2PD6k3YPOt5yo6nxobFfhjRMh3XcnuZ5kQghjicHql7ORgJBiuSPLWpchZfml8p4oF9TTu0nF2dOOrAcy+DN0w5shUOhDXIZsTVkj/xkrZbXWjKKhYWF7EWLz6WaWIya+OLbNPqv63mG6mooes67cbBy+4SS7b3fWrOFl+3XLbvjY0uOrKpYSyqyfQ2UBgwosh7fXdHwzc9p+255CcXRWgWKzEPbCYEyN4cadIE5lS0pQ4/aEu7K0qstc92E4gPJyiuCOg5Xp1BZrNsEFhoPs6yyFdXADQ1rkST2MQ2Kz4H0QhypSDyPRL4+c/aae8iawl9Rzg9JFxa3ht5Qy9AjC//MgYdkL9ZxuKt8ULwOeENBEOlPcnbNKrr9vwk6nZeuXBjD1SMyoS+hAFIZgciygC8eQ0l90H7jN6GvpqDJx1tbDHa7wkHeGdcLkdyTJLV4DLSVJIQh4Czz5p3LWQbKMM6a55+39o/8aMmW9mAHcBR7wFMaMv8m8s4JIzJl5JAYqy4pTAKhYYfwHAxKz02kwvchTJHDBL+RoV2FSQimsAu4KmXxfXJCTEaRiSbt3t0wI0oLkjDB22Wn/INdQC1ywle/D1ShDzjIJEuZHQVJSHPkFlXJc/Jup+yMCewCqt89Rhlrv1PiP0penZ+17e1EMTNUc4wx85jgtJ5QUQGTlElNOSXFuuzCFTkpFuVouqVxjHpaw3Nb9f8DlIum3w3E4BwAAAAASUVORK5CYII=" alt="è¿‘æœŸè€ƒé¢˜" class="w-5 h-5 mr-2">
                                        è¿‘æœŸè€ƒé¢˜
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Essay Writing Section -->
                    <div class="rounded-lg min-h-[1240px] mt-6 mx-6">
                        <div class="essay-input-panel bg-white border border-[#2563eb] rounded-lg w-full h-full flex flex-col gap-2 relative">
                            <!-- Stats Header -->
                            <div class="flex items-center justify-end gap-5 px-5 py-2">
                                <div class="flex items-center justify-end gap-1">
                                    <span id="paragraph-count" class="text-[#2563eb] text-xl font-semibold font-['PingFang SC']">0</span>
                                    <span class="text-black text-lg font-normal font-['PingFang SC']">Paragraphs</span>
                                </div>
                                <div class="flex items-center justify-end gap-1">
                                    <span id="word-count" class="text-[#2563eb] text-xl font-semibold font-['PingFang SC']">0</span>
                                    <span class="text-black text-lg font-normal font-['PingFang SC']">Words</span>
                                </div>
                                <div class="flex items-center justify-end gap-1">
                                    <span id="sentence-count" class="text-[#2563eb] text-xl font-semibold font-['PingFang SC']">0</span>
                                    <span class="text-black text-lg font-normal font-['PingFang SC']">Sentences</span>
                                </div>
                            </div>

                            <!-- Writing Area -->
                            <div class="container mx-auto px-1 h-full flex flex-col rounded-lg">
                                <!-- Writing Toolbar -->
                                <div class="flex items-center justify-between p-4 bg-gray-50 border-b border-gray-200 rounded-t-lg">
                                    <div class="flex items-center gap-3">
                                        <button id="generate-sample-toolbar" class="flex items-center bg-blue-600 border border-blue-600 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-700 hover:scale-105 transition-all">
                                            <span class="text-sm font-normal font-['PingFang SC']">ğŸ¤– AIç”ŸæˆèŒƒæ–‡</span>
                                        </button>
                                        <span class="text-sm text-gray-600 font-['PingFang SC']">ç”ŸæˆèŒƒæ–‡åå¯é€‰æ‹©æ’å…¥æˆ–å‚è€ƒ</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <button id="insert-sample" class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700 transition-colors font-['PingFang SC']" style="display: none;">
                                            ğŸ“ æ’å…¥èŒƒæ–‡
                                        </button>
                                        <button id="reference-sample" class="bg-orange-500 text-white px-3 py-1 rounded text-sm hover:bg-orange-600 transition-colors font-['PingFang SC']" style="display: none;">
                                            ğŸ‘ï¸ æŸ¥çœ‹èŒƒæ–‡
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="min-h-[900px] flex-1 rounded-lg relative">
                                    <div id="writing-display" class="absolute inset-0 p-4 pointer-events-none z-10 opacity-0 transition-opacity duration-300" style="font-family: 'PingFang SC', monospace; white-space: pre-wrap; word-wrap: break-word; line-height: 1.6; font-size: 18px; color: black; caret-color: rgb(37, 99, 235);"></div>
                                    <div contenteditable="true" translate="no" id="user-essay" class="tiptap ProseMirror border-gray-400 p-4 mx-auto focus:outline-none max-h-[1050px] relative z-20 bg-transparent focus:bg-white transition-colors" tabindex="0" style="color: black; font-size: 18px; font-weight: 400; font-family: 'PingFang SC'; overflow-y: auto; caret-color: rgb(37, 99, 235);">
                                        <p>è¯·è¾“å…¥TOEFLå†™ä½œå†…å®¹ï¼ˆå»ºè®®300-400ä¸ªè¯ï¼‰</p>
                                    </div>
                                </div>
                                
                                <!-- Action Buttons -->
                                <div class="h-16 flex items-center justify-end gap-2 py-2">
                                    <button id="toggle-analysis" class="bg-blue-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-600 transition-colors font-['PingFang SC']">
                                        ğŸ“Š Show Analysis
                                    </button>
                                    <button id="ai-score-btn" class="ai-score-btn bg-gradient-to-r from-green-500 to-blue-500 text-white px-6 py-2 rounded-full flex justify-center items-center hover:from-green-600 hover:to-blue-600 transition-all shadow-lg font-['PingFang SC']">
                                        ğŸ¯ AIè¯„åˆ†
                                    </button>
                                    <button id="clear-essay" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors font-['PingFang SC']">
                                        ğŸ—‘ï¸ æ¸…ç©º
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Sidebar -->
                <div class="col-span-1 rounded-lg h-full flex flex-col space-y-5 w-96 px-4">
                    <div class="p-2 h-20 rounded-lg mt-4"></div>
                    <div class="flex flex-col items-center gap-4">
                        <button class="w-64 h-16 px-12 py-6 bg-[#2563eb] rounded-full justify-center items-center gap-2.5 inline-flex hover:bg-[#1d4ed8] transition-all">
                            <img src="data:image/svg+xml,%3csvg%20width='17'%20height='20'%20viewBox='0%200%2017%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20id='Vector'%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M5.363%2013.8025L4.999%2018.6608C4.97342%2019.0022%205.27692%2019.2373%205.54838%2019.0852C7.47038%2018.0086%2013.491%2014.0543%2016.5424%205.36345C16.6823%204.96478%2016.3063%204.60503%2015.9853%204.82991C14.1828%206.0922%2010.2436%208.70124%207.80921%209.1982C7.80921%209.1982%209.36817%208.11541%2010.3013%206.4532C10.3928%206.29024%2010.3852%206.08166%2010.2832%205.93457L6.88029%201.02983C6.67863%200.739088%206.26475%200.85955%206.19192%201.23015L5.13254%206.62066L0.160155%2010.9604C-0.089158%2011.1779%20-0.0382996%2011.6175%200.249542%2011.7339L5.363%2013.8025Z'%20fill='white'/%3e%3c/svg%3e" alt="AIè¯„åˆ†" class="w-4 h-4 mr-2">
                            <div class="text-center text-white text-lg font-normal font-['PingFang SC']">AIè¯„åˆ†</div>
                        </button>

                        <!-- Timer Component -->
                        <button class="w-64 h-16 px-4 py-4 bg-white rounded-full shadow border flex items-center justify-center hover:bg-gray-50 transition-all">
                            <div class="flex justify-center items-center gap-2.5">
                                <img src="data:image/svg+xml,%3csvg%20width='20'%20height='20'%20viewBox='0%200%2020%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20id='Stopwatch%20(%26%23231%3b%26%23167%3b%26%23146%3b%26%23232%3b%26%23161%3b%26%23168%3b)'%3e%3cpath%20id='Vector'%20d='M9.99996%2018.3332C13.912%2018.3332%2017.0833%2015.1618%2017.0833%2011.2498C17.0833%207.33784%2013.912%204.1665%209.99996%204.1665C6.08796%204.1665%202.91663%207.33784%202.91663%2011.2498C2.91663%2015.1618%206.08796%2018.3332%209.99996%2018.3332Z'%20stroke='%23333333'%20stroke-width='1.66667'%20stroke-linejoin='round'/%3e%3cpath%20id='Vector_2'%20d='M12.9167%201.6665H7.08337'%20stroke='%23333333'%20stroke-width='1.66667'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20id='Vector_3'%20d='M10%2011.2498V7.08317'%20stroke='%23333333'%20stroke-width='1.66667'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20id='Vector_4'%20d='M15.5892%205.24463L14.7683%206.06546'%20stroke='%23333333'%20stroke-width='1.66667'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/g%3e%3c/svg%3e" alt="Timer" class="w-5 h-5">
                                <div class="text-[#333333] text-lg font-medium font-['PingFang SC']">30:00</div>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Sample Reference Modal -->
    <div id="sample-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center" style="display: none;">
        <div class="bg-white rounded-xl p-6 max-w-4xl max-h-[80vh] w-full mx-4 overflow-hidden flex flex-col">
            <div class="flex justify-between items-center mb-4 border-b pb-4">
                <h3 class="text-xl font-semibold text-blue-700 font-['Alibaba PuHuiTi 3.0']">ğŸ¤– AIç”ŸæˆèŒƒæ–‡å‚è€ƒ</h3>
                <button id="close-sample-modal" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <div id="sample-content" class="flex-1 overflow-y-auto border border-gray-200 rounded-lg p-4 bg-gray-50 font-['PingFang SC'] leading-relaxed">
                <!-- AI generated content will be inserted here -->
            </div>
            <div class="flex justify-end gap-3 mt-4 pt-4 border-t">
                <button id="copy-sample" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors font-['PingFang SC']">
                    ğŸ“‹ å¤åˆ¶èŒƒæ–‡
                </button>
                <button id="insert-sample-modal" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-['PingFang SC']">
                    ğŸ“ æ’å…¥åˆ°å†™ä½œåŒº
                </button>
            </div>
        </div>
    </div>

    <!-- Scoring Section -->
    <div class="bg-white shadow-lg p-6 rounded-xl mt-6 mx-6" id="scoring-section" style="display: none;">
        <h2 class="text-xl font-semibold mb-4 font-['Alibaba PuHuiTi 3.0'] text-purple-700">ğŸ¯ AIè¯„åˆ†åˆ†æ</h2>
        <div id="scoring" class="w-full border border-gray-200 rounded-lg p-4 mb-4 text-gray-700 min-h-[300px] bg-gray-50 font-['PingFang SC'] leading-relaxed"></div>
    </div>

    <!-- Include similar sidebars and analysis panels as previous versions -->
    <!-- Scoring Rubric Sidebar -->
    <div id="scoring-sidebar" class="fixed left-0 top-0 h-full w-80 bg-white shadow-lg transform -translate-x-full transition-transform duration-300 z-50 overflow-y-auto">
        <div class="p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-blue-600">TOEFL Scoring Rubric</h3>
                <button id="close-sidebar" class="text-gray-500 hover:text-gray-700">&times;</button>
            </div>
            <div class="text-sm space-y-4">
                <div class="bg-green-50 p-3 rounded">
                    <h4 class="font-bold text-green-700">Score 5 (Excellent)</h4>
                    <ul class="text-xs mt-2 space-y-1">
                        <li>â€¢ Effectively addresses the topic and task</li>
                        <li>â€¢ Well organized and developed</li>
                        <li>â€¢ Displays unity, progression, and coherence</li>
                        <li>â€¢ Consistent facility in language use</li>
                    </ul>
                </div>
                <div class="bg-blue-50 p-3 rounded">
                    <h4 class="font-bold text-blue-700">Score 4 (Good)</h4>
                    <ul class="text-xs mt-2 space-y-1">
                        <li>â€¢ Addresses the topic well</li>
                        <li>â€¢ Generally well organized</li>
                        <li>â€¢ Good unity and progression</li>
                        <li>â€¢ Occasional minor errors</li>
                    </ul>
                </div>
                <div class="bg-yellow-50 p-3 rounded">
                    <h4 class="font-bold text-yellow-700">Score 3 (Fair)</h4>
                    <ul class="text-xs mt-2 space-y-1">
                        <li>â€¢ Somewhat developed explanations</li>
                        <li>â€¢ Ideas may be occasionally obscured</li>
                        <li>â€¢ Inconsistent sentence formation</li>
                    </ul>
                </div>
                <div class="bg-orange-50 p-3 rounded">
                    <h4 class="font-bold text-orange-700">Score 2 (Limited)</h4>
                    <ul class="text-xs mt-2 space-y-1">
                        <li>â€¢ Limited development</li>
                        <li>â€¢ Inadequate organization</li>
                        <li>â€¢ Errors in sentence structure</li>
                    </ul>
                </div>
                <div class="bg-red-50 p-3 rounded">
                    <h4 class="font-bold text-red-700">Score 1 (Seriously Flawed)</h4>
                    <ul class="text-xs mt-2 space-y-1">
                        <li>â€¢ Serious disorganization</li>
                        <li>â€¢ Little or no detail</li>
                        <li>â€¢ Frequent errors</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Timer Sidebar -->
    <div id="timer-sidebar" class="fixed right-0 top-0 h-full w-64 bg-white shadow-lg transform translate-x-full transition-transform duration-300 z-50">
        <div class="p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-blue-600">Writing Timer</h3>
                <button id="close-timer" class="text-gray-500 hover:text-gray-700">&times;</button>
            </div>
            <div class="text-center">
                <div id="timer-display" class="text-4xl font-bold text-gray-800 mb-4">30:00</div>
                <div class="space-y-2">
                    <button id="start-timer" class="w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700">Start Timer</button>
                    <button id="pause-timer" class="w-full bg-yellow-600 text-white py-2 px-4 rounded hover:bg-yellow-700">Pause</button>
                    <button id="reset-timer" class="w-full bg-red-600 text-white py-2 px-4 rounded hover:bg-red-700">Reset</button>
                </div>
                <div id="timer-warning" class="mt-4 text-red-600 font-bold hidden">âš ï¸ 5 minutes left!</div>
            </div>
        </div>
    </div>

    <!-- Toggle Buttons -->
    <button id="show-sidebar" class="fixed left-4 top-32 bg-blue-600 text-white px-3 py-2 rounded-r hover:bg-blue-700 z-40">
        ğŸ“Š Scoring Guide
    </button>
    <button id="show-timer" class="fixed right-4 top-32 bg-blue-600 text-white px-3 py-2 rounded-l hover:bg-blue-700 z-40">
        â±ï¸ Timer
    </button>

    <!-- Analysis Panel (similar structure) -->
    <div id="analysis-panel" class="fixed right-0 top-0 h-full w-96 bg-white shadow-2xl transform translate-x-full transition-transform duration-300 z-50 border-l">
        <div class="p-6 h-full flex flex-col">
            <div class="flex justify-between items-center mb-4 pb-4 border-b">
                <h4 class="font-bold text-gray-800 text-lg">ğŸ“Š Writing Analysis</h4>
                <button id="close-analysis" class="text-gray-500 hover:text-gray-700 text-xl font-bold">&times;</button>
            </div>
            
            <div class="flex mb-4 border-b overflow-x-auto">
                <button id="tab-errors" class="feedback-tab flex-shrink-0 px-2 py-2 text-xs border-b-2 border-red-500 text-red-600 font-semibold">
                    <span class="inline-block w-2 h-2 bg-red-200 rounded mr-1"></span>Errors
                </button>
                <button id="tab-strengths" class="feedback-tab flex-shrink-0 px-2 py-2 text-xs border-b-2 border-transparent text-gray-600">
                    <span class="inline-block w-2 h-2 bg-green-200 rounded mr-1"></span>Strengths
                </button>
                <button id="tab-vocabulary" class="feedback-tab flex-shrink-0 px-2 py-2 text-xs border-b-2 border-transparent text-gray-600">
                    <span class="inline-block w-2 h-2 bg-blue-200 rounded mr-1"></span>Vocab
                </button>
                <button id="tab-structure" class="feedback-tab flex-shrink-0 px-2 py-2 text-xs border-b-2 border-transparent text-gray-600">
                    <span class="inline-block w-2 h-2 bg-purple-200 rounded mr-1"></span>Structure
                </button>
                <button id="tab-toefl" class="feedback-tab flex-shrink-0 px-2 py-2 text-xs border-b-2 border-transparent text-gray-600">
                    <span class="inline-block w-2 h-2 bg-indigo-200 rounded mr-1"></span>TOEFL
                </button>
                <button id="tab-overall" class="feedback-tab flex-shrink-0 px-2 py-2 text-xs border-b-2 border-transparent text-gray-600">
                    <span class="inline-block w-2 h-2 bg-gray-200 rounded mr-1"></span>Summary
                </button>
            </div>
            
            <div id="feedback-content" class="flex-1 overflow-y-auto">
                <div id="feedback-errors" class="feedback-panel">
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-2">âœï¸</div>
                        <p class="text-sm">Start writing to see analysis...</p>
                    </div>
                </div>
                <!-- Other feedback panels... -->
            </div>
        </div>
    </div>

    <script>
        // Similar functionality to GRE but adapted for TOEFL
        let currentAnalysis = null;
        let highlightTimeout = null;
        let timerInterval = null;
        let timeLeft = 30 * 60; // 30 minutes for TOEFL
        let isRunning = false;

        function updateWordCount() {
            const text = document.getElementById('user-essay').textContent || document.getElementById('user-essay').innerText;
            const words = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
            const paragraphs = text.trim() === '' ? 0 : text.split(/\n\s*\n/).filter(p => p.trim().length > 0).length;
            const sentences = text.trim() === '' ? 0 : text.split(/[.!?]+/).filter(s => s.trim().length > 0).length;
            
            document.getElementById('word-count').textContent = words;
            document.getElementById('paragraph-count').textContent = paragraphs;
            document.getElementById('sentence-count').textContent = sentences;
            
            clearTimeout(highlightTimeout);
            if (words > 10) {
                highlightTimeout = setTimeout(() => {
                    checkWritingAutomatically();
                }, 3000);
            }
        }

        // Timer functions
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const display = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('timer-display').textContent = display;
            
            if (timeLeft <= 5 * 60 && timeLeft > 0) {
                document.getElementById('timer-warning').classList.remove('hidden');
            } else {
                document.getElementById('timer-warning').classList.add('hidden');
            }
            
            if (timeLeft === 0) {
                clearInterval(timerInterval);
                isRunning = false;
                alert('Time is up! 30 minutes have elapsed.');
            }
        }

        function startTimer() {
            if (!isRunning) {
                isRunning = true;
                timerInterval = setInterval(() => {
                    timeLeft--;
                    updateTimerDisplay();
                }, 1000);
            }
        }

        function pauseTimer() {
            clearInterval(timerInterval);
            isRunning = false;
        }

        function resetTimer() {
            clearInterval(timerInterval);
            isRunning = false;
            timeLeft = 30 * 60;
            updateTimerDisplay();
        }

        // Panel functions (similar to previous versions)
        function showSidebar() {
            document.getElementById('scoring-sidebar').classList.remove('-translate-x-full');
            document.getElementById('show-sidebar').classList.add('hidden');
        }

        function hideSidebar() {
            document.getElementById('scoring-sidebar').classList.add('-translate-x-full');
            document.getElementById('show-sidebar').classList.remove('hidden');
        }

        function showTimer() {
            document.getElementById('timer-sidebar').classList.remove('translate-x-full');
            document.getElementById('show-timer').classList.add('hidden');
        }

        function hideTimer() {
            document.getElementById('timer-sidebar').classList.add('translate-x-full');
            document.getElementById('show-timer').classList.remove('hidden');
        }

        function showAnalysisPanel() {
            document.getElementById('analysis-panel').classList.remove('translate-x-full');
            document.getElementById('toggle-analysis').innerHTML = 'ğŸ“Š Hide Analysis';
        }

        function hideAnalysisPanel() {
            document.getElementById('analysis-panel').classList.add('translate-x-full');
            document.getElementById('toggle-analysis').innerHTML = 'ğŸ“Š Show Analysis';
        }

        function toggleAnalysisPanel() {
            const panel = document.getElementById('analysis-panel');
            if (panel.classList.contains('translate-x-full')) {
                showAnalysisPanel();
            } else {
                hideAnalysisPanel();
            }
        }

        async function checkWritingAutomatically() {
            const text = document.getElementById('user-essay').textContent || document.getElementById('user-essay').innerText;
            if (text.length < 50) return;
            console.log('Auto-checking TOEFL writing:', text);
        }

        async function checkWritingManually() {
            const text = document.getElementById('user-essay').textContent || document.getElementById('user-essay').innerText;
            if (!text.trim()) {
                alert('Please write something first!');
                return;
            }
            
            document.getElementById('feedback-errors').innerHTML = '<div class="text-blue-600">ğŸ” Analyzing your writing...</div>';
            console.log('Manual check:', text);
            showAnalysisPanel();
        }

        // AI Generation and Scoring variables
        let currentEssay = '';
        let currentPrompt = '';

        // AIç”ŸæˆèŒƒæ–‡åŠŸèƒ½ï¼ˆæ–°çš„åˆå¹¶ç‰ˆæœ¬ï¼‰
        async function generateSample() {
            const promptSelect = document.getElementById('prompt');
            currentPrompt = promptSelect.options[promptSelect.selectedIndex].text;
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('generate-sample-toolbar').innerHTML = '<span class="text-sm font-normal font-[\'PingFang SC\']">ğŸ”„ æ­£åœ¨ç”Ÿæˆ...</span>';
            document.getElementById('generate-sample-toolbar').disabled = true;
            
            try {
                const response = await fetch('/generate_sample', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ prompt: currentPrompt }),
                });

                const data = await response.json();
                if (data.sample) {
                    currentEssay = data.sample;
                    
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    document.getElementById('generate-sample-toolbar').innerHTML = '<span class="text-sm font-normal font-[\'PingFang SC\']">ğŸ¤– AIç”ŸæˆèŒƒæ–‡</span>';
                    document.getElementById('generate-sample-toolbar').disabled = false;
                    
                    // æ˜¾ç¤ºæ“ä½œæŒ‰é’®
                    document.getElementById('insert-sample').style.display = 'block';
                    document.getElementById('reference-sample').style.display = 'block';
                    
                    // å­˜å‚¨ç”Ÿæˆçš„èŒƒæ–‡å†…å®¹
                    document.getElementById('sample-content').innerHTML = `<div class="prose max-w-none font-['PingFang SC'] leading-relaxed text-gray-800">${data.sample}</div>`;
                    
                    // æ˜¾ç¤ºæˆåŠŸæç¤º
                    showToast('ğŸ‰ AIèŒƒæ–‡ç”ŸæˆæˆåŠŸï¼æ‚¨å¯ä»¥é€‰æ‹©æ’å…¥åˆ°å†™ä½œåŒºæˆ–æŸ¥çœ‹å‚è€ƒã€‚', 'success');
                    
                } else {
                    document.getElementById('generate-sample-toolbar').innerHTML = '<span class="text-sm font-normal font-[\'PingFang SC\']">ğŸ¤– AIç”ŸæˆèŒƒæ–‡</span>';
                    document.getElementById('generate-sample-toolbar').disabled = false;
                    showToast('âŒ ç”ŸæˆèŒƒæ–‡å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                }
            } catch (error) {
                document.getElementById('generate-sample-toolbar').innerHTML = '<span class="text-sm font-normal font-[\'PingFang SC\']">ğŸ¤– AIç”ŸæˆèŒƒæ–‡</span>';
                document.getElementById('generate-sample-toolbar').disabled = false;
                showToast('âŒ ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥åé‡è¯•', 'error');
            }
        }

        // æ’å…¥èŒƒæ–‡åˆ°å†™ä½œåŒº
        function insertSampleToEditor() {
            if (!currentEssay) {
                showToast('âŒ æ²¡æœ‰å¯æ’å…¥çš„èŒƒæ–‡å†…å®¹', 'error');
                return;
            }
            
            const userEssay = document.getElementById('user-essay');
            const currentContent = userEssay.textContent || userEssay.innerText;
            
            if (currentContent.trim() !== '' && currentContent.trim() !== 'è¯·è¾“å…¥TOEFLå†™ä½œå†…å®¹ï¼ˆå»ºè®®300-400ä¸ªè¯ï¼‰') {
                if (confirm('å½“å‰å†™ä½œåŒºæœ‰å†…å®¹ï¼Œæ˜¯å¦è¦æ›¿æ¢ä¸ºAIç”Ÿæˆçš„èŒƒæ–‡ï¼Ÿ\n\nç‚¹å‡»"ç¡®å®š"æ›¿æ¢å½“å‰å†…å®¹\nç‚¹å‡»"å–æ¶ˆ"æ·»åŠ åˆ°æœ«å°¾')) {
                    // æ›¿æ¢å†…å®¹
                    userEssay.innerHTML = `<div>${currentEssay}</div>`;
                } else {
                    // æ·»åŠ åˆ°æœ«å°¾
                    userEssay.innerHTML += `<div><br><hr><br><strong>AIç”ŸæˆèŒƒæ–‡å‚è€ƒï¼š</strong><br>${currentEssay}</div>`;
                }
            } else {
                // å†™ä½œåŒºä¸ºç©ºï¼Œç›´æ¥æ’å…¥
                userEssay.innerHTML = `<div>${currentEssay}</div>`;
            }
            
            updateWordCount();
            showToast('âœ… èŒƒæ–‡å·²æ’å…¥åˆ°å†™ä½œåŒº', 'success');
        }

        // æ˜¾ç¤ºèŒƒæ–‡å‚è€ƒæ¨¡æ€æ¡†
        function showSampleModal() {
            if (!currentEssay) {
                showToast('âŒ æ²¡æœ‰å¯æŸ¥çœ‹çš„èŒƒæ–‡å†…å®¹', 'error');
                return;
            }
            
            document.getElementById('sample-modal').style.display = 'flex';
        }

        // å…³é—­èŒƒæ–‡å‚è€ƒæ¨¡æ€æ¡†
        function closeSampleModal() {
            document.getElementById('sample-modal').style.display = 'none';
        }

        // å¤åˆ¶èŒƒæ–‡åˆ°å‰ªè´´æ¿
        async function copySampleToClipboard() {
            if (!currentEssay) {
                showToast('âŒ æ²¡æœ‰å¯å¤åˆ¶çš„èŒƒæ–‡å†…å®¹', 'error');
                return;
            }
            
            try {
                // æå–çº¯æ–‡æœ¬å†…å®¹
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = currentEssay;
                const textContent = tempDiv.textContent || tempDiv.innerText || '';
                
                await navigator.clipboard.writeText(textContent);
                showToast('ğŸ“‹ èŒƒæ–‡å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
            } catch (error) {
                showToast('âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶', 'error');
            }
        }

        // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white font-['PingFang SC'] z-50 ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 
                'bg-blue-500'
            }`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // AIè¯„åˆ†åŠŸèƒ½ï¼ˆç»Ÿä¸€è¯„åˆ†æ¥å£ï¼‰
        async function scoreEssay() {
            const userEssay = document.getElementById('user-essay').textContent || document.getElementById('user-essay').innerText;
            const promptSelect = document.getElementById('prompt');
            currentPrompt = promptSelect.options[promptSelect.selectedIndex].text;
            
            if (!userEssay || userEssay.trim().length === 0 || userEssay.trim() === 'è¯·è¾“å…¥TOEFLå†™ä½œå†…å®¹ï¼ˆå»ºè®®300-400ä¸ªè¯ï¼‰') {
                alert('è¯·å…ˆå†™ä½œæ–‡');
                return;
            }

            if (userEssay.split(/\s+/).length < 30) {
                alert('ä½œæ–‡å¤ªçŸ­ï¼Œè¯·è‡³å°‘å†™30ä¸ªå•è¯');
                return;
            }

            // æ˜¾ç¤ºè¯„åˆ†åŒºåŸŸå’ŒåŠ è½½çŠ¶æ€
            document.getElementById('scoring-section').style.display = 'block';
            document.getElementById('scoring').innerHTML = '<div style="text-align: center; padding: 40px; color: #6B7280;"><div class="text-4xl mb-2">ğŸ¯</div><p class="text-lg font-medium">æ­£åœ¨AIåˆ†æè¯„åˆ†...</p><p class="text-sm mt-2">è¯·ç¨å€™...</p></div>';

            try {
                const response = await fetch('/score_essay', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        essay: userEssay.trim(),
                        prompt: currentPrompt 
                    }),
                });

                const data = await response.json();
                if (data.scoring) {
                    document.getElementById('scoring').innerHTML = `<div class="prose max-w-none font-['PingFang SC'] leading-relaxed text-gray-800">${data.scoring}</div>`;
                } else {
                    document.getElementById('scoring').innerHTML = '<div class="text-center py-8 text-red-500"><div class="text-4xl mb-2">âŒ</div><p>è¯„åˆ†å¤±è´¥ï¼Œè¯·é‡è¯•</p></div>';
                }
            } catch (error) {
                document.getElementById('scoring').innerHTML = '<div class="text-center py-8 text-red-500"><div class="text-4xl mb-2">âŒ</div><p>ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥åé‡è¯•</p></div>';
            }
        }

        // æ¸…ç©ºä½œæ–‡åŠŸèƒ½
        function clearEssay() {
            const userEssay = document.getElementById('user-essay');
            userEssay.innerHTML = '<p>è¯·è¾“å…¥TOEFLå†™ä½œå†…å®¹ï¼ˆå»ºè®®300-400ä¸ªè¯ï¼‰</p>';
            updateWordCount();
            
            // éšè—åˆ†æå’Œè¯„åˆ†åŒºåŸŸ
            document.getElementById('scoring-section').style.display = 'none';
            hideAnalysisPanel();
            
            // é‡ç½®AIç”Ÿæˆç›¸å…³çš„çŠ¶æ€
            currentEssay = '';
            document.getElementById('insert-sample').style.display = 'none';
            document.getElementById('reference-sample').style.display = 'none';
            closeSampleModal();
            
            showToast('ğŸ—‘ï¸ å†™ä½œå†…å®¹å·²æ¸…ç©º', 'info');
        }

        // Event listeners
        document.getElementById('user-essay').addEventListener('input', updateWordCount);
        document.getElementById('toggle-analysis').addEventListener('click', toggleAnalysisPanel);
        document.getElementById('ai-score-btn').addEventListener('click', scoreEssay);
        document.getElementById('clear-essay').addEventListener('click', clearEssay);
        
        // æ–°çš„åˆå¹¶åŠŸèƒ½äº‹ä»¶ç›‘å¬å™¨
        document.getElementById('generate-sample-toolbar').addEventListener('click', generateSample);
        document.getElementById('insert-sample').addEventListener('click', insertSampleToEditor);
        document.getElementById('reference-sample').addEventListener('click', showSampleModal);
        document.getElementById('close-sample-modal').addEventListener('click', closeSampleModal);
        document.getElementById('copy-sample').addEventListener('click', copySampleToClipboard);
        document.getElementById('insert-sample-modal').addEventListener('click', () => {
            insertSampleToEditor();
            closeSampleModal();
        });
        
        // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
        document.getElementById('sample-modal').addEventListener('click', (e) => {
            if (e.target.id === 'sample-modal') {
                closeSampleModal();
            }
        });
        document.getElementById('close-analysis').addEventListener('click', hideAnalysisPanel);

        document.getElementById('show-sidebar').addEventListener('click', showSidebar);
        document.getElementById('close-sidebar').addEventListener('click', hideSidebar);
        document.getElementById('show-timer').addEventListener('click', showTimer);
        document.getElementById('close-timer').addEventListener('click', hideTimer);
        
        document.getElementById('start-timer').addEventListener('click', startTimer);
        document.getElementById('pause-timer').addEventListener('click', pauseTimer);
        document.getElementById('reset-timer').addEventListener('click', resetTimer);

        // Tab switching
        document.getElementById('tab-correction').addEventListener('click', function() {
            this.classList.remove('inactive-tab');
            this.classList.add('active-tab');
            document.getElementById('tab-stepbystep').classList.remove('active-tab');
            document.getElementById('tab-stepbystep').classList.add('inactive-tab');
        });

        document.getElementById('tab-stepbystep').addEventListener('click', function() {
            this.classList.remove('inactive-tab');
            this.classList.add('active-tab');
            document.getElementById('tab-correction').classList.remove('active-tab');
            document.getElementById('tab-correction').classList.add('inactive-tab');
        });

        // Initialize
        updateTimerDisplay();
        updateWordCount();
    </script>
</body>
</html>